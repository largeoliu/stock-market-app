# 股值通小程序 - 项目文档

## 项目概述

**股值通**是一个基于微信小程序的股票信息查询和分析工具，提供股票搜索、详情查看、自选管理、趋势分析等功能。

- **项目名称**: 股值通 (Stock Market Cap Mini Program)
- **当前版本**: v1.0.15
- **平台**: 微信小程序
- **开发语言**: JavaScript, WXML, WXSS
- **AppID**: wxf74b30061d4d1df2

## 核心功能

### 1. 股票搜索 (`pages/index/index`)
- **热门股票**: 显示当前热门股票列表，支持点击查看详情
- **搜索功能**: 支持股票代码和名称模糊搜索
- **搜索历史**: 记录最近20条搜索记录
- **自选股票**: 用户收藏的股票列表，支持本地存储和云端同步

### 2. 股票详情 (`pages/detail/detail`)
- **基本信息**: 股票名称、代码、当前价格、涨跌幅等
- **趋势图表**: 使用 Canvas 2D API 绘制趋势图表
- **技术指标**: 换手率、市值等关键指标
- **操作功能**: 加入/取消自选、分享等

### 3. 自选股管理
- **本地存储**: 使用 localStorage 缓存用户自选股
- **云端同步**: 支持数据迁移到服务端
- **排序功能**: 按添加时间倒序显示
- **批量操作**: 支持清空全部自选股

## 技术架构

### 页面结构
```
pages/
├── index/          # 首页 - 搜索和自选股管理
│   ├── index.js    # 页面逻辑
│   ├── index.json  # 页面配置
│   ├── index.wxml  # 页面结构
│   └── index.wxss  # 页面样式
└── detail/         # 详情页 - 股票详细信息
    ├── detail.js   # 页面逻辑
    ├── detail.json # 页面配置
    ├── detail.wxml # 页面结构
    └── detail.wxss # 页面样式
```

### 组件化架构
```
components/
├── simple-chart/      # 简单图表组件
│   ├── simple-chart.js
│   ├── simple-chart.json
│   ├── simple-chart.wxml
│   └── simple-chart.wxss
└── skeleton/          # 骨架屏组件
    ├── skeleton.js
    ├── skeleton.json
    ├── skeleton.wxml
    └── skeleton.wxss
```

### 工具模块
```
utils/
├── api.js              # API 接口封装
├── api-config.example.js # API 配置示例
├── util.js             # 通用工具函数
├── track.js            # 用户行为埋点
├── performance.js      # 性能监控
└── performance-report.js # 性能报告
```

## 核心特性

### 1. 性能优化
- **延迟渲染**: 使用 `initialLoading` 状态避免页面闪烁
- **并行加载**: 同时加载热门股票和自选股数据
- **防抖搜索**: 500ms 防抖优化搜索体验
- **图表优化**: 60fps 限制图表重绘频率
- **内存监控**: 实时监控内存使用情况

### 2. 数据管理
- **本地存储**: 
  - `favorite_stocks`: 自选股列表
  - `recent_searches`: 搜索历史
  - `logs`: 访问日志
- **云端同步**: 支持自选股数据迁移到服务端
- **错误恢复**: 网络异常时降级到本地数据

### 3. 用户体验
- **骨架屏**: 数据加载期间显示占位内容
- **触觉反馈**: tab 切换时提供震动反馈
- **错误处理**: 完善的错误提示和重试机制
- **响应式设计**: 适配不同屏幕尺寸和安全区域

### 4. 图表功能
- **交互式图表**: 支持触摸选择数据点
- **多种图表**: K线图、趋势线、成交量等
- **实时数据**: 支持实时价格更新
- **技术指标**: 移动平均线、MACD等技术分析

## API 接口

### 主要接口
- `searchStock(keyword)`: 股票搜索
- `getStockDetail(symbol)`: 获取股票详情
- `getHotSearchStocks()`: 获取热门股票
- `getFavorites()`: 获取自选股列表
- `addFavorite(stock)`: 添加自选股
- `removeFavorite(symbol)`: 删除自选股
- `syncLocalFavorites()`: 同步本地自选股到云端

### 数据格式
```javascript
// 股票基本信息
{
  symbol: "000001",     // 股票代码
  name: "平安银行",      // 股票名称
  market: "A股",        // 市场类型
  price: "12.34",       // 当前价格
  change: "+0.12",      // 涨跌额
  changePercent: "+0.98%" // 涨跌幅
}
```

## 部署配置

### 版本管理
- **当前版本**: 1.0.15
- **版本策略**: 语义化版本管理 (semantic versioning)
- **自动部署**: 使用 VSCode 任务和脚本自动化部署

### 配置文件
- `deploy.config.js`: 部署配置
- `project.config.json`: 微信小程序项目配置
- `app.json`: 小程序全局配置

## 开发指引

### 开发环境设置
1. 安装微信开发者工具
2. 导入项目，配置 AppID
3. 配置 API 服务器地址（`utils/api-config.js`）

### 测试
- 单元测试: Jest 框架
- 覆盖率报告: 支持生成测试覆盖率

### 代码规范
- ES6+ 语法
- 模块化设计
- 错误边界处理
- 性能监控埋点

## 最近更新

### v1.0.16 (2025-08-06)
- 🎨 升级 simple-chart 组件至 Canvas 2D API
- 🔧 替换所有已弃用的 wx.getSystemInfoSync API
- 🧹 移除未使用的 ec-canvas 和 stock-compare 组件
- ⚡ 性能优化：支持同层渲染，提升渲染性能

### v1.0.15 (2025-08-04)
- ✨ 优化默认tab显示逻辑，避免页面闪烁
- 🚀 添加initialLoading状态，实现延迟渲染
- 💡 使用骨架屏组件提升加载体验
- 🐛 修复有自选股时先显示热搜再跳转的问题

### 历史版本
- v1.0.14: 优化默认tab显示逻辑
- v1.0.13: 添加用户行为埋点功能
- v1.0.12: 性能监控和优化
- v1.0.11: 添加用户行为埋点功能

## 注意事项

### 开发注意
1. **不要直接修改线上数据**: 测试时使用测试环境
2. **API配置**: 确保 `api-config.js` 配置正确
3. **性能监控**: 新功能需要添加性能埋点
4. **错误处理**: 所有网络请求都要有错误处理

### 部署注意
1. **版本号**: 每次部署前确认版本号递增
2. **代码审查**: 重要功能需要代码审查
3. **测试验证**: 部署前在开发环境充分测试
4. **用户体验**: 确保向后兼容性

## 联系信息

- **开发者**: liuhao
- **项目地址**: /Users/liuhao/code/bull
- **最后更新**: 2025-08-06